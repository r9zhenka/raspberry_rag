# Feature Specification: Голосовой ассистент кафедры

**Feature Branch**: `001-voice-assistant`
**Created**: 2026-02-28
**Status**: Draft
**Input**: Голосовой ассистент кафедры — speech-to-speech система на Raspberry Pi 5 (4GB RAM). Три модуля: ASR, RAG, TTS. Русский язык. Только бесплатные open-source решения.

## User Scenarios & Testing *(mandatory)*

### User Story 1 — Голосовой вопрос по кнопке (Priority: P1)

Студент подходит к устройству на кафедре, нажимает кнопку, задаёт вопрос голосом на русском языке (например: «Какие предметы на первом курсе?»). Ассистент распознаёт речь, находит релевантную информацию в базе знаний кафедры, формирует ответ и озвучивает его через динамик.

**Why this priority**: Это основной сценарий использования — ядро всей системы. Без него остальные фичи бессмысленны. Push-to-talk проще в реализации, чем wake word, и даёт полноценный MVP.

**Independent Test**: Можно протестировать, нажав кнопку, произнеся вопрос и проверив, что ответ озвучен голосом и содержит релевантную информацию.

**Acceptance Scenarios**:

1. **Given** устройство включено и готово, **When** пользователь нажимает кнопку и говорит «Какие предметы на первом курсе?», **Then** ассистент озвучивает ответ с перечнем предметов из базы знаний в течение 10 секунд
2. **Given** устройство включено, **When** пользователь нажимает кнопку и говорит неразборчиво или молчит, **Then** ассистент сообщает голосом что не удалось распознать вопрос и просит повторить
3. **Given** устройство включено, **When** пользователь спрашивает о чём-то, чего нет в базе знаний, **Then** ассистент сообщает, что не нашёл информацию по этому вопросу

---

### User Story 2 — Активация голосом (wake word) (Priority: P2)

Студент находится рядом с устройством и говорит ключевую фразу (например: «Окей, кафедра»). Ассистент активируется, подаёт звуковой сигнал готовности, после чего слушает вопрос и отвечает голосом.

**Why this priority**: Дополнительный режим взаимодействия для удобства — руки могут быть заняты. Требует постоянного прослушивания, что сложнее в реализации.

**Independent Test**: Произнести wake word, дождаться сигнала, задать вопрос — получить голосовой ответ.

**Acceptance Scenarios**:

1. **Given** устройство в режиме ожидания, **When** пользователь произносит wake word, **Then** ассистент подаёт звуковой сигнал и начинает слушать вопрос
2. **Given** ассистент активирован wake word'ом, **When** пользователь задаёт вопрос, **Then** ассистент отвечает голосом как в Story 1
3. **Given** устройство в режиме ожидания, **When** звучит обычная речь без wake word, **Then** ассистент не активируется

---

### User Story 3 — Управление базой знаний (Priority: P2)

Администратор (преподаватель или сотрудник кафедры) загружает документы с информацией о кафедре (расписание, учебные планы, информация о преподавателях, FAQ) в систему. Документы индексируются и становятся доступны для поиска ассистентом.

**Why this priority**: Без возможности обновлять базу знаний ассистент быстро устареет. Необходим простой механизм загрузки документов.

**Independent Test**: Загрузить документ, задать вопрос по его содержимому, получить корректный ответ.

**Acceptance Scenarios**:

1. **Given** папка с документами на устройстве, **When** администратор кладёт новый PDF/DOCX/TXT файл в папку, **Then** документ автоматически индексируется и информация из него доступна для ответов
2. **Given** документ загружен и проиндексирован, **When** пользователь задаёт вопрос по содержимому документа, **Then** ассистент отвечает на основе этого документа
3. **Given** администратор удаляет документ из папки, **When** система переиндексирует базу, **Then** информация из удалённого документа больше не используется

---

### User Story 4 — Автозапуск и стабильная работа (Priority: P3)

Устройство автоматически запускает ассистента при включении Raspberry Pi. Система работает стабильно без необходимости ручного перезапуска.

**Why this priority**: Важно для реального использования на кафедре — устройство должно быть plug-and-play. Но это инфраструктурная задача, не влияет на core-функциональность.

**Independent Test**: Перезагрузить Raspberry Pi, убедиться что ассистент запустился автоматически и готов к работе.

**Acceptance Scenarios**:

1. **Given** Raspberry Pi выключен, **When** устройство включается, **Then** ассистент запускается автоматически и готов к работе в течение 2 минут
2. **Given** ассистент работает длительное время, **When** проходит 24+ часа непрерывной работы, **Then** система продолжает корректно отвечать на вопросы без деградации

---

### Edge Cases

- Что происходит, если пользователь говорит одновременно с ответом ассистента?
- Как система ведёт себя при шумном окружении (коридор, аудитория)?
- Что если документ в базе знаний повреждён или в неподдерживаемом формате?
- Как система реагирует на вопросы не по теме кафедры?
- Как ведёт себя система при переполнении памяти на Raspberry Pi (4GB)?

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: Система MUST распознавать русскую речь из аудио с микрофона и преобразовывать в текст
- **FR-002**: Система MUST поддерживать режим push-to-talk (активация физической кнопкой)
- **FR-003**: Система MUST поддерживать режим wake word (активация голосовой командой)
- **FR-004**: Система MUST искать релевантную информацию в базе знаний кафедры по текстовому запросу пользователя
- **FR-005**: Система MUST генерировать ответ на русском языке на основе найденной информации
- **FR-006**: Система MUST синтезировать речь из текстового ответа и воспроизводить через динамик
- **FR-007**: Система MUST поддерживать загрузку документов в форматах PDF, DOCX, TXT для базы знаний
- **FR-008**: Система MUST автоматически индексировать новые документы при их добавлении в папку
- **FR-009**: Система MUST сообщать пользователю, если не удалось распознать речь или найти ответ
- **FR-010**: Система MUST работать на Raspberry Pi 5 с 4GB RAM
- **FR-011**: Система MUST использовать только бесплатные open-source компоненты
- **FR-014**: Система MUST работать полностью оффлайн, без интернет-соединения
- **FR-012**: Система MUST подавать звуковой сигнал при активации (готовность слушать)
- **FR-013**: Система MUST запускаться автоматически при включении устройства

### Key Entities

- **Аудиозапрос**: записанный с микрофона звуковой фрагмент с речью пользователя
- **Текстовый запрос**: распознанный текст из аудиозаписи
- **Документ базы знаний**: файл (PDF/DOCX/TXT) с информацией о кафедре
- **Индекс**: векторное представление документов для семантического поиска
- **Контекст**: набор релевантных фрагментов документов, найденных по запросу
- **Текстовый ответ**: сгенерированный ответ на основе контекста
- **Аудиоответ**: синтезированная речь из текстового ответа

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: Пользователь получает голосовой ответ на вопрос в течение 10 секунд с момента окончания речи
- **SC-002**: Система корректно распознаёт 80%+ вопросов на русском языке в условиях тихого помещения
- **SC-003**: 70%+ ответов содержат релевантную информацию из базы знаний при наличии соответствующего документа
- **SC-004**: Система стабильно работает 24+ часа без перезагрузки и деградации
- **SC-005**: Новый документ доступен для поиска в течение 5 минут после добавления в папку
- **SC-006**: Система потребляет не более 3.5GB RAM в пиковой нагрузке (оставляя запас для ОС)
- **SC-007**: Система запускается и готова к работе в течение 2 минут после включения устройства

## Assumptions

- Raspberry Pi 5 подключён к микрофону и динамику (USB или 3.5mm jack)
- На устройстве установлена Raspberry Pi OS (64-bit, Debian-based)
- Для push-to-talk используется GPIO-кнопка или USB-кнопка
- Помещение — относительно тихое (кабинет, лаборатория, не столовая)
- Документы кафедры на русском языке
- Интернет-соединение отсутствует — система работает полностью оффлайн
